<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Generate MP3 Audio Files</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .progress { margin: 10px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Generate MP3 Audio Files</h1>
        <div id="status" class="status">Ready to generate audio files...</div>
        <div id="progress" class="progress"></div>
        <button id="generateBtn" onclick="generateAllAudio()">Generate All Audio Files</button>
        
        <h2>Audio Files to Generate:</h2>
        <ul id="fileList"></ul>
    </div>

    <script>
        const audioFiles = [
            { name: 'intro', text: 'Chào mừng đến với hướng dẫn sử dụng Từ Điển Đa Ngữ. Trang này sẽ hướng dẫn bạn cách sử dụng ứng dụng một cách hiệu quả nhất.' },
            { name: 'basic-usage', text: 'Cách sử dụng cơ bản. Nhập từ cần tra cứu vào ô tìm kiếm và chọn ngôn ngữ nguồn và đích. Nhấn nút loa để nghe phát âm của từ vựng. Kiểm tra các từ đã tra cứu trước đó trong phần lịch sử.' },
            { name: 'shortcuts', text: 'Phím tắt hữu ích. Phím D để chuyển đến trang từ điển. Phím H để về trang chủ. Phím G để mở hướng dẫn sử dụng. Phím P để phát hoặc tạm dừng audio. Phím cộng để tăng kích thước chữ. Phím trừ để giảm kích thước chữ. Phím 0 để đặt kích thước chữ về bình thường.' },
            { name: 'features', text: 'Tính năng nổi bật. Hỗ trợ 8 ngôn ngữ bao gồm tiếng Việt, tiếng Anh, tiếng Nhật, tiếng Hàn, tiếng Trung, tiếng Pháp, tiếng Đức, tiếng Tây Ban Nha. Phát âm tự động bằng giọng nói tiếng Việt tự nhiên. Lưu trữ 20 từ tra cứu gần nhất. 6 cấp độ kích thước chữ từ nhỏ đến khổng lồ. Thân thiện với screen reader và có thể sử dụng hoàn toàn bằng bàn phím.' },
            { name: 'tips', text: 'Mẹo sử dụng. Sử dụng phím tắt để điều hướng nhanh chóng và hiệu quả hơn. Luôn nghe phát âm để học cách đọc từ vựng chính xác. Tăng kích thước chữ nếu cần thiết để dễ đọc hơn. Kiểm tra lịch sử để ôn lại các từ đã học.' }
        ];

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log(message);
        }

        function updateProgress(current, total) {
            const progress = document.getElementById('progress');
            progress.innerHTML = `Progress: ${current}/${total} (${Math.round(current/total*100)}%)`;
        }

        function updateFileList() {
            const list = document.getElementById('fileList');
            list.innerHTML = audioFiles.map(file => 
                `<li><strong>${file.name}.mp3</strong> - ${file.text.substring(0, 50)}...</li>`
            ).join('');
        }

        async function generateAudio(audioFile) {
            return new Promise((resolve, reject) => {
                if (!('speechSynthesis' in window)) {
                    reject('Speech synthesis not supported');
                    return;
                }

                // Get Vietnamese voice
                const voices = window.speechSynthesis.getVoices();
                let vietnameseVoice = voices.find(voice => 
                    voice.lang.includes('vi') || 
                    voice.name.includes('Vietnamese') ||
                    voice.name.includes('Vietnam')
                );

                if (!vietnameseVoice) {
                    vietnameseVoice = voices.find(voice => 
                        voice.lang.includes('vi-VN') ||
                        voice.lang.includes('vi')
                    );
                }

                const utterance = new SpeechSynthesisUtterance(audioFile.text);
                utterance.lang = 'vi-VN';
                utterance.rate = 1.0;
                utterance.pitch = 1;
                utterance.volume = 1;

                if (vietnameseVoice) {
                    utterance.voice = vietnameseVoice;
                }

                // Create audio context for recording
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const destination = audioContext.createMediaStreamDestination();
                const mediaRecorder = new MediaRecorder(destination.stream);
                const chunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    chunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'audio/wav' });
                    const url = URL.createObjectURL(blob);
                    
                    // Create download link
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${audioFile.name}.wav`; // Save as WAV first
                    a.click();
                    
                    URL.revokeObjectURL(url);
                    resolve();
                };

                utterance.onstart = () => {
                    mediaRecorder.start();
                };

                utterance.onend = () => {
                    setTimeout(() => {
                        mediaRecorder.stop();
                    }, 500);
                };

                utterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    reject(event);
                };

                // Start speaking
                window.speechSynthesis.speak(utterance);
            });
        }

        async function generateAllAudio() {
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            updateStatus('Starting audio generation...');
            updateFileList();
            
            for (let i = 0; i < audioFiles.length; i++) {
                const audioFile = audioFiles[i];
                updateStatus(`Generating ${audioFile.name}.wav...`);
                updateProgress(i + 1, audioFiles.length);
                
                try {
                    await generateAudio(audioFile);
                    updateStatus(`Generated ${audioFile.name}.wav successfully`);
                } catch (error) {
                    updateStatus(`Error generating ${audioFile.name}.wav: ${error}`);
                }
                
                // Wait between generations
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            updateStatus('All audio files generated! Check your downloads folder. You can rename .wav to .mp3 if needed.');
            updateProgress(audioFiles.length, audioFiles.length);
            
            btn.disabled = false;
            btn.textContent = 'Generate All Audio Files';
        }

        // Initialize
        window.addEventListener('load', () => {
            updateFileList();
            
            // Wait for voices to load
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => {
                    updateStatus('Voices loaded. Ready to generate audio files.');
                };
            } else {
                setTimeout(() => {
                    updateStatus('Ready to generate audio files.');
                }, 2000);
            }
        });
    </script>
</body>
</html>